{
  "name": "hoodie-plugin-users",
  "version": "0.1.1",
  "repository": {
    "type": "git",
    "url": "https://github.com/hoodiehq/hoodie-plugin-users.git"
  },
  "dependencies": {
    "clone": "^0.1.11"
  },
  "devDependencies": {
    "grunt": "~0.4.0",
    "grunt-contrib-copy": "~0.4.0",
    "grunt-contrib-concat": "~0.1.2",
    "grunt-contrib-coffee": "~0.4.0",
    "grunt-contrib-uglify": "~0.1.1",
    "grunt-contrib-compass": "~0.1.2",
    "grunt-contrib-jshint": "~0.1.1",
    "grunt-contrib-cssmin": "~0.4.1",
    "grunt-contrib-connect": "0.1.2",
    "grunt-contrib-clean": "0.4.0",
    "grunt-contrib-htmlmin": "0.1.1",
    "grunt-contrib-handlebars": "0.5.9",
    "grunt-contrib-imagemin": "0.1.2",
    "grunt-contrib-livereload": "0.1.1",
    "grunt-bower-hooks": "~0.2.0",
    "grunt-usemin": "~0.1.9",
    "grunt-regarde": "~0.1.1",
    "grunt-mocha": "~0.2.2",
    "grunt-open": "~0.2.0",
    "matchdep": "~0.1.1"
  },
  "main": "worker.js",
  "readme": "[![Build Status](https://travis-ci.org/hoodiehq/worker-users.png?branch=master)](https://travis-ci.org/hoodiehq/worker-users)\n\nHoodie Users Plugin\n===================\n\nThis plugin is used internally by [hoodie-server].\nIt picks up user sign ups, creates user databases and handles password resets.\n\nBesides that it also provides a view for pocket to manage the users of your app.\n\n\nHow things work behind the curtain\n----------------------------------\n\nHoodie is using CouchDB's built-in [authentication module] based on the `_users` database.\nWhen a user signs up using `hoodie.account.signUp('joe@example.com','secret'), the following\ndoc gets created:\n\n```json\n{\n   \"_id\": \"org.couchdb.user:user/joe@example.com\",\n   \"_rev\": \"4f9b7ea8424eb477b8cbb6cba49e0dd5\",\n   \"name\": \"user/joe@example.com\",\n   \"roles\": [],\n   \"type\": \"user\",\n   \"ownerHash\": \"uuid567\",\n   \"database\": \"user/uuid567\",\n   \"password_scheme\": \"pbkdf2\",\n   \"derived_key\": \"4b1d247f488fd4f335a4e0d16f2c5386a5ac98b1\",\n   \"salt\": \"564aa550233a06f3bbed1cf014ee21e1\"\n}\n```\n\nThe worker of the Users Plugin listens to the [changes feed] of the `_users` database. If\na new doc of type: \"user\" pops up the worker confirms the user (if auto confirmation is enabled).\nTo confirm a user, the worker creates a database \"user/uuid567\", `uuid567` being the autogenerated\nand globally unique user hash. It then sets the [database security] so that only user `joe@example.com`\ncan access it. Once finished, the `_users` doc will be flagged as confirmed by setting `roles` to\n`[\"confirmed\", \"uuid567\"]`. If an error occured, the `roles` property will be set to `[\"error\"]` and an\n`$error` property will be added with an explanation.\n\n\nUsername changes\n----------------\n\nChanging a username is rather tricky in CouchDB land, as the username is part of the `_users` doc._id.\nSo instead, an entire new doc has to be created and theh the old one needs to be removed.\n\nWhen the user runs `hoodie.account.changeUsername('secret', 'newjoe@example.com')`, the user's `_users` doc\nwill be updated with a new property: `\"$newUsername\": \"newjoe@example.com\"`. The users worker will pick that\nup, create a new doc with `\"_id\": \"org.couchdb.user:user/newjoe@example.com\"`, copy over all properties and\nthen remove the old document. `hoodie.account.changeUsername` checks if the old `_users` doc has been removed.\nOnce that happened, it will sign out silently, sign back in using the new username and then resolve its promise.\n\n\nPassword resets\n---------------\n\nThe only database that a signed out user can write to securely (without other users being able to read it)\nis the `_users` database. So when a user runs `hoodie.account.resetPassword( \"joe@example.com\" )`, we create\na special object with `\"_id\": \"org.couchdb.user:$passwordReset/joe@example.com/uuid123\"`. `uuid123` is a globally unique id\nthat gets generated for the password reset and stored locally in the user's browser. The `$passwordReset` doc\nis technically a CouchDB user, so we set the password to `uuid123` as well.\n\nThe worker picks up new `$passwordReset`, generates a new password for `joe@example.com`, updates Joe's `_users`\ndoc and deletes `$passwordReset` again. If there is an error, it updates the `$passwordReset` doc with a descriptive\n`$error` property instead.\n\nIn the browser, `hoodie.account.resetPassword` listens to changes on the `$passwordReset` doc. If it gets removed,\nit resolves its promise. If the `$error` property gets added, it rejects with its message.\n\n\nAnonymous users\n---------------\n\nHoodie can be used entirely without accounts. That usually means, that data gets only stored in the user's\nbrowser. There are cases though when data needs to be synchronized to CouchDB, for example when an anonymous\nuser wants to send an email, share data or do any different kind background tasks. You might also decide as an \napp developer that you want to store data of anonymous users to prevent data loss.\n\nTo create an account for an anonymous user and to kick off data synchronization, you can use \n`hoodie.account.anonymousSignUp()`. This will create a doc in `_users` that looks similar to what \n`hoodie.account.signUp(username, password)` generates:\n\n```json\n{\n   \"_id\": \"org.couchdb.user:anonymous_user/uuid567\",\n   \"_rev\": \"4f9b7ea8424eb477b8cbb6cba49e0dd5\",\n   \"name\": \"user/uuid567\",\n   \"roles\": [],\n   \"type\": \"user\",\n   \"ownerHash\": \"uuid567\",\n   \"database\": \"user/uuid567\",\n   \"password_scheme\": \"pbkdf2\",\n   \"derived_key\": \"4b1d247f488fd4f335a4e0d16f2c5386a5ac98b1\",\n   \"salt\": \"564aa550233a06f3bbed1cf014ee21e1\"\n}\n```\n\nThe only differences are:\n\n1. `username` gets set to the users autogenerated hash, which is a globally unique uuid.\n2. `password` gets generated and stored locally in the users browser.\n\nHoodie will recognize that the user has an anonyomus account and will authenticate silently\nin the background. If than at some point the user signs up for a real account by running\n`hoodie.account.signup( 'joe@example.com', 'secret')`, it will internally be handled as\na username change, from `uuid567` to `joe@example.com`.\n\n\nPlugin settings\n---------------\n\nSettings for the users plugin are not implemented yet. But what we plan to do is:\n\n1. Send tokens instead of passwords via email.\n2. Automatic user confirmation / send confirmation tokens via email + `hoodie.account.confirm(token)` / manual user confirmation / manual user management\n3. Set custom texts for the emails (user confirmation, password reset, etc)\n\n\n  [hoodie-server]: https://github.com/hoodiehq/hoodie-server\n  [authentication module]: http://wiki.apache.org/couchdb/Security_Features_Overview#Authentication_database\n  [changes feed]: http://wiki.apache.org/couchdb/HTTP_database_API#Changes\n  [database security]: http://wiki.apache.org/couchdb/Security_Features_Overview#Authorization\n",
  "readmeFilename": "README.md",
  "description": "[![Build Status](https://travis-ci.org/hoodiehq/worker-users.png?branch=master)](https://travis-ci.org/hoodiehq/worker-users)",
  "bugs": {
    "url": "https://github.com/hoodiehq/hoodie-plugin-users/issues"
  },
  "homepage": "https://github.com/hoodiehq/hoodie-plugin-users",
  "_id": "hoodie-plugin-users@0.1.1",
  "_shasum": "27b8566dae5a5c4beb3b1814b8ad3ce998dd176c",
  "_from": "hoodie-plugin-users@^0.1.1",
  "_resolved": "https://registry.npmjs.org/hoodie-plugin-users/-/hoodie-plugin-users-0.1.1.tgz"
}
